<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trends Virals - Your Hub for Trending Content</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body data-page="home">
    <!-- Header with Navigation -->
    <header>
        <div class="logo-container">
            <h1>Trends Virals</h1>
            <p class="tagline">Discover What's Trending</p>
        </div>

        <nav class="main-nav">
            <ul>
                <li><a href="index.html" class="active">Home</a></li>
                <li><a href="news.html">News</a></li>
                <li><a href="community.html" class="highlight">Community</a></li>
            </ul>
        </nav>

        <div class="user-section">
            <a href="login.html" class="btn login-btn">Log In</a>
            <a href="signup.html" class="btn signup-btn">Sign Up</a>
            <button class="search-toggle"><i class="fas fa-search"></i></button>
        </div>
        <div class="logged-in-only" style="display: none;">

            <div class="dropdown-menu">
                <a href="profile.html"><i class="fas fa-user"></i> My Profile</a>
                <a href="saved-articles.html"><i class="fas fa-bookmark"></i> Saved Articles</a>
                <a href="settings.html"><i class="fas fa-cog"></i> Settings</a>
                <a href="#" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Log Out</a>
            </div>
        </div>
    </header>

    <!-- Search Bar -->
    <div class="search-container">
        <form action="search.html" method="get">
            <input type="text" name="query" placeholder="Search for trending topics...">
            <button type="submit"><i class="fas fa-search"></i></button>
        </form>
    </div>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h2>Discover What's Trending Today</h2>
            <p>Stay updated with the latest trends in education, finance, entertainment, sports, news, and the internet.
            </p>
            <a href="community.html" class="btn cta-btn">Join Our Community</a>
        </div>
    </section>

    <!-- Admin Featured Posts -->
    <section class="featured-content">
        <h2 class="section-title">Editor's Picks</h2>

        <div class="content-grid" id="featured-posts">
            <!-- Featured posts will be loaded here -->
            <div class="loading-indicator">
                <i class="fas fa-spinner fa-spin"></i> Loading featured content...
            </div>
        </div>

        <div id="admin-controls" class="admin-controls" style="display: none;">
            <button id="add-featured-post-btn" class="btn admin-btn">
                <i class="fas fa-plus"></i> Add New Featured Post
            </button>
        </div>
    </section>

    <!-- Latest News -->
    <section class="latest-news">
        <div class="section-header">
            <h2>Latest Updates</h2>
            <a href="news.html" class="view-all">View All News</a>
        </div>

        <div class="news-cards" id="latest-news">
            <!-- Latest news will be loaded here -->
            <div class="loading-indicator">
                <i class="fas fa-spinner fa-spin"></i> Loading latest news...
            </div>
        </div>

        <div id="admin-news-controls" class="admin-controls" style="display: none;">
            <button id="add-news-post-btn" class="btn admin-btn">
                <i class="fas fa-plus"></i> Add News Update
            </button>
        </div>
    </section>

    <!-- Community Highlights -->
    <section class="community-highlights">
        <div class="section-header">
            <h2>Community Highlights</h2>
            <a href="community.html" class="view-all">Explore Community</a>
        </div>

        <div class="community-posts" id="community-highlights">
            <!-- Community highlights will be loaded here -->
            <div class="loading-indicator">
                <i class="fas fa-spinner fa-spin"></i> Loading community highlights...
            </div>
        </div>

        <a href="community.html" class="btn cta-btn">Join the Conversation</a>
    </section>

    <!-- Newsletter Section -->
    <section class="newsletter">
        <div class="newsletter-content">
            <h2>Stay Updated with Trends Virals</h2>
            <p>Subscribe to our newsletter and never miss the latest trends across all categories.</p>
            <form class="newsletter-form" id="newsletter-form">
                <input type="email" placeholder="Enter your email address" required>
                <button type="submit" class="btn">Subscribe</button>
            </form>
        </div>
    </section>

    <!-- Admin Post Modal -->
    <div id="post-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Add New Post</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="post-form">
                    <input type="hidden" id="post-id">
                    <input type="hidden" id="post-type" value="featured">

                    <div class="form-group">
                        <label for="post-title">Title</label>
                        <input type="text" id="post-title" required>
                    </div>

                    <div class="form-group">
                        <label for="post-excerpt">Excerpt/Summary</label>
                        <textarea id="post-excerpt" rows="3" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="post-content">Content</label>
                        <textarea id="post-content" rows="6" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="post-category">Category</label>
                        <select id="post-category" required>
                            <option value="">Select Category</option>
                            <option value="education">Education</option>
                            <option value="finance">Finance</option>
                            <option value="entertainment">Entertainment</option>
                            <option value="sports">Sports</option>
                            <option value="news">News</option>
                            <option value="technology">Technology</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="post-image">Image URL</label>
                        <input type="text" id="post-image" placeholder="">
                    </div>

                    <div class="form-group">
                        <label for="post-author">Author</label>
                        <input type="text" id="post-author">
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn cancel-btn">Cancel</button>
                        <button type="submit" class="btn save-btn">Save Post</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <h2>Trends Virals</h2>
                <p>Your Hub for Trending Content</p>
            </div>

            <div class="footer-links">
                <div class="link-column">
                    <h3>Explore</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="news.html">News</a></li>
                        <li><a href="community.html">Community</a></li>
                    </ul>
                </div>

                <div class="link-column">
                    <h3>Company</h3>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="terms.html">Terms of Service</a></li>
                        <li><a href="privacy.html">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>

            <div class="social-media">
                <h3>Follow Us</h3>
                <div class="social-icons">
                    <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
        </div>

        <div class="copyright">
            <p>&copy; 2025 Trends Virals. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script type="module" src="js/firebase-config.js"></script>
    <script src="js/main.js"></script>
    <script type="module">
        import { db, auth } from './js/firebase-config.js';
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import {
            collection,
            getDocs,
            getDoc,
            doc,
            addDoc,
            updateDoc,
            deleteDoc,
            query,
            where,
            orderBy,
            limit,
            serverTimestamp
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { logoutUser } from './js/auth.js';

        // Global state
        let isAdmin = false;
        let currentUser = null;

        // DOM Elements
        const featuredPostsContainer = document.getElementById('featured-posts');
        const latestNewsContainer = document.getElementById('latest-news');
        const communityHighlightsContainer = document.getElementById('community-highlights');
        const adminControls = document.getElementById('admin-controls');
        const adminNewsControls = document.getElementById('admin-news-controls');
        const addFeaturedPostBtn = document.getElementById('add-featured-post-btn');
        const addNewsPostBtn = document.getElementById('add-news-post-btn');
        const postModal = document.getElementById('post-modal');
        const postForm = document.getElementById('post-form');
        const modalTitle = document.getElementById('modal-title');
        const postTypeInput = document.getElementById('post-type');
        const closeModalBtn = document.querySelector('.close-modal');
        const cancelBtn = document.querySelector('.cancel-btn');
        const newsletterForm = document.getElementById('newsletter-form');

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Set up authentication state listener
            onAuthStateChanged(auth, handleAuthStateChange);

            // Load content sections
            loadFeaturedPosts();
            loadLatestNews();
            loadCommunityHighlights();

            // Set up event listeners
            if (addFeaturedPostBtn) {
                addFeaturedPostBtn.addEventListener('click', () => showAddPostModal('featured'));
            }

            if (addNewsPostBtn) {
                addNewsPostBtn.addEventListener('click', () => showAddPostModal('news'));
            }

            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', hideModal);
            }

            if (cancelBtn) {
                cancelBtn.addEventListener('click', hideModal);
            }

            if (postForm) {
                postForm.addEventListener('submit', handlePostSubmission);
            }

            if (newsletterForm) {
                newsletterForm.addEventListener('submit', handleNewsletterSubmission);
            }

            // Add event delegation for edit/delete post buttons
            document.addEventListener('click', handlePostActions);

            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === postModal) {
                    hideModal();
                }
            });
        });

        // Handle auth state changes
        async function handleAuthStateChange(user) {
            const loginLinks = document.querySelectorAll('.login-btn, .signup-btn');
            const userElements = document.querySelectorAll('.logged-in-only');

            currentUser = user;

            if (user) {
                console.log('User is signed in:', user.email);

                // Check if user is admin
                try {
                    const userDoc = await getDoc(doc(db, "users", user.uid));
                    isAdmin = userDoc.exists() && userDoc.data().isAdmin === true;

                    // Show admin controls if user is admin
                    if (isAdmin) {
                        if (adminControls) adminControls.style.display = 'block';
                        if (adminNewsControls) adminNewsControls.style.display = 'block';
                    }
                } catch (error) {
                    console.error("Error checking admin status:", error);
                }

                // Update UI for logged in state
                loginLinks.forEach(link => link.style.display = 'none');
                userElements.forEach(element => {
                    element.style.display = 'block';

                    // Update user display name
                    const userDisplayName = element.querySelector('.user-display-name');
                    if (userDisplayName) {
                        userDisplayName.textContent = user.displayName || user.email.split('@')[0];
                    }

                    // Update user avatar
                    const userAvatar = element.querySelector('.user-avatar-img');
                    if (userAvatar) {
                        userAvatar.src = user.photoURL || 'img/default-avatar.png';
                    }
                });

                // Set up logout buttons
                const logoutButtons = document.querySelectorAll('.logout-btn');
                logoutButtons.forEach(button => {
                    button.addEventListener('click', async (e) => {
                        e.preventDefault();
                        try {
                            const result = await logoutUser();
                            if (result.success) {
                                window.location.reload();
                            }
                        } catch (error) {
                            console.error("Logout error:", error);
                        }
                    });
                });
            } else {
                console.log('User is signed out');

                // Reset admin status
                isAdmin = false;

                // Hide admin controls
                if (adminControls) adminControls.style.display = 'none';
                if (adminNewsControls) adminNewsControls.style.display = 'none';

                // Update UI for logged out state
                loginLinks.forEach(link => link.style.display = 'inline-block');
                userElements.forEach(element => element.style.display = 'none');
            }
        }

        // Load featured posts from Firestore
        async function loadFeaturedPosts() {
            try {
                // Show loading indicator
                featuredPostsContainer.innerHTML = '<div class="loading-indicator"><i class="fas fa-spinner fa-spin"></i> Loading featured content...</div>';

                // Create query
                const postsQuery = query(
                    collection(db, "featured_posts"),
                    orderBy("createdAt", "desc"),
                    limit(3)
                );

                // Execute query
                const querySnapshot = await getDocs(postsQuery);

                // Clear loading indicator
                featuredPostsContainer.innerHTML = '';

                // Check if we have posts
                if (querySnapshot.empty) {
                    featuredPostsContainer.innerHTML = `
                        <div class="empty-state">
                            <p>No featured posts available. ${isAdmin ? 'Use the button below to add some!' : ''}</p>
                        </div>
                    `;
                    return;
                }

                // Process posts
                querySnapshot.forEach((doc) => {
                    const post = {
                        id: doc.id,
                        ...doc.data()
                    };

                    // Add post to UI
                    featuredPostsContainer.appendChild(createFeaturedPostElement(post));
                });
            } catch (error) {
                console.error('Error loading featured posts:', error);
                featuredPostsContainer.innerHTML = `
                    <div class="error-state">
                        <p>Error loading featured posts. Please try again later.</p>
                    </div>
                `;
            }
        }

        // Load latest news from Firestore
        async function loadLatestNews() {
            try {
                // Show loading indicator
                latestNewsContainer.innerHTML = '<div class="loading-indicator"><i class="fas fa-spinner fa-spin"></i> Loading latest news...</div>';

                // Create query
                const newsQuery = query(
                    collection(db, "news_posts"),
                    orderBy("createdAt", "desc"),
                    limit(3)
                );

                // Execute query
                const querySnapshot = await getDocs(newsQuery);

                // Clear loading indicator
                latestNewsContainer.innerHTML = '';

                // Check if we have posts
                if (querySnapshot.empty) {
                    latestNewsContainer.innerHTML = `
                        <div class="empty-state">
                            <p>No news posts available. ${isAdmin ? 'Use the button below to add some!' : ''}</p>
                        </div>
                    `;
                    return;
                }

                // Process posts
                querySnapshot.forEach((doc) => {
                    const post = {
                        id: doc.id,
                        ...doc.data()
                    };

                    // Add post to UI
                    latestNewsContainer.appendChild(createNewsPostElement(post));
                });
            } catch (error) {
                console.error('Error loading news posts:', error);
                latestNewsContainer.innerHTML = `
                    <div class="error-state">
                        <p>Error loading news posts. Please try again later.</p>
                    </div>
                `;
            }
        }

        // Load community highlights from Firestore
        async function loadCommunityHighlights() {
            try {
                // Show loading indicator
                communityHighlightsContainer.innerHTML = '<div class="loading-indicator"><i class="fas fa-spinner fa-spin"></i> Loading community highlights...</div>';

                // Create query for popular community posts
                const postsQuery = query(
                    collection(db, "community_posts"),
                    orderBy("likes", "desc"),
                    limit(2)
                );

                // Execute query
                const querySnapshot = await getDocs(postsQuery);

                // Clear loading indicator
                communityHighlightsContainer.innerHTML = '';

                // Check if we have posts
                if (querySnapshot.empty) {
                    communityHighlightsContainer.innerHTML = `
                        <div class="empty-state">
                            <p>No community posts available. Visit the community page to start a conversation!</p>
                        </div>
                    `;
                    return;
                }

                // Process posts
                querySnapshot.forEach((doc) => {
                    const post = {
                        id: doc.id,
                        ...doc.data()
                    };

                    // Add post to UI
                    communityHighlightsContainer.appendChild(createCommunityPostElement(post));
                });
            } catch (error) {
                console.error('Error loading community posts:', error);
                communityHighlightsContainer.innerHTML = `
                    <div class="error-state">
                        <p>Error loading community posts. Please try again later.</p>
                    </div>
                `;
            }
        }

        // Create featured post element
        function createFeaturedPostElement(post) {
            const article = document.createElement('article');
            article.className = 'featured-card';
            article.dataset.id = post.id;

            // Format date
            const formattedDate = formatDate(post.createdAt);

            // Create HTML
            article.innerHTML = `
                <div class="card-image">
                    <img src="${post.imageUrl || ''}" alt="${post.title}" onerror="'">
                    <span class="category-tag ${post.category || 'general'}">${capitalizeFirstLetter(post.category || 'General')}</span>
                    ${isAdmin ? `
                        <div class="admin-actions">
                            <button class="edit-post-btn" data-id="${post.id}" data-type="featured"><i class="fas fa-edit"></i></button>
                            <button class="delete-post-btn" data-id="${post.id}" data-type="featured"><i class="fas fa-trash"></i></button>
                        </div>
                    ` : ''}
                </div>
                <div class="card-content">
                    <h3>${post.title}</h3>
                    <p class="excerpt">${post.excerpt}</p>
                    <div class="card-meta">
                        <span class="author">By ${post.author || 'Admin'}</span>
                        <span class="date">${formattedDate}</span>
                        <span class="views"><i class="fas fa-eye"></i> ${post.views || 0}</span>
                    </div>
                </div>
            `;

            // Add click event to navigate to full article
            article.addEventListener('click', (e) => {
                // Don't navigate if clicking on admin buttons
                if (e.target.closest('.admin-actions')) {
                    return;
                }

                window.location.href = `article.html?id=${post.id}`;
            });

            return article;
        }

        // Create news post element
        function createNewsPostElement(post) {
            const article = document.createElement('article');
            article.className = 'news-card';
            article.dataset.id = post.id;

            // Format date
            const formattedDate = formatDate(post.createdAt);

            // Create HTML
            article.innerHTML = `
                <div class="card-image">
                    <img src="${post.imageUrl || ''}" alt="${post.title}" onerror="'">
                    <span class="category-tag ${post.category || 'news'}">${capitalizeFirstLetter(post.category || 'News')}</span>
                    ${isAdmin ? `
                        <div class="admin-actions">
                            <button class="edit-post-btn" data-id="${post.id}" data-type="news"><i class="fas fa-edit"></i></button>
                            <button class="delete-post-btn" data-id="${post.id}" data-type="news"><i class="fas fa-trash"></i></button>
                        </div>
                    ` : ''}
                </div>
                <div class="card-content">
                    <h3>${post.title}</h3>
                    <p class="excerpt">${post.excerpt}</p>
                    <div class="card-meta">
                        <span class="date">${formattedDate}</span>
                    </div>
                </div>
            `;

            // Add click event to navigate to full article
            article.addEventListener('click', (e) => {
                // Don't navigate if clicking on admin buttons
                if (e.target.closest('.admin-actions')) {
                    return;
                }

                window.location.href = `news.html?id=${post.id}`;
            });

            return article;
        }

        // Create community post element
        function createCommunityPostElement(post) {
            const div = document.createElement('div');
            div.className = 'community-post';
            div.dataset.id = post.id;

            // Format date
            const formattedDate = formatDate(post.createdAt);

            // Create HTML
            div.innerHTML = `
                <div class="post-header">
                    <img src="${post.userPhoto || ''}" alt="${post.displayName || 'User'}" class="user-avatar" onerror="this.src=''">
                    <div class="post-info">
                        <h3 class="username">@${post.username || 'user'}</h3>
                        <span class="post-time">${formattedDate}</span>
                    </div>
                </div>
                <div class="post-content">
                    <p>${post.content}</p>
                    ${post.attachmentUrl ? `<img src="${post.attachmentUrl}" alt="Post Image" class="post-image">` : ''}
                </div>
                <div class="post-actions">
                    <button class="like-btn"><i class="fas fa-heart"></i> ${post.likes || 0}</button>
                    <button class="comment-btn"><i class="fas fa-comment"></i> ${post.comments || 0}</button>
                    <button class="share-btn"><i class="fas fa-share"></i> Share</button>
                </div>
            `;

            return div;
        }

        // Show post modal for adding/editing
        function showAddPostModal(type, postId = null) {
            postTypeInput.value = type;

            if (postId) {
                // Edit existing post
                modalTitle.textContent = type === 'featured' ? 'Edit Featured Post' : 'Edit News Post';
                loadPostData(type, postId);
            } else {
                // Add new post
                modalTitle.textContent = type === 'featured' ? 'Add New Featured Post' : 'Add News Update';
                postForm.reset();
                document.getElementById('post-id').value = '';
            }

            // Show modal
            postModal.style.display = 'block';
        }

        // Load post data for editing
        async function loadPostData(type, postId) {
            try {
                const collectionName = type === 'featured' ? 'featured_posts' : 'news_posts';
                const postDoc = await getDoc(doc(db, collectionName, postId));

                if (postDoc.exists()) {
                    const post = postDoc.data();

                    // Set form fields
                    document.getElementById('post-id').value = postId;
                    document.getElementById('post-title').value = post.title || '';
                    document.getElementById('post-excerpt').value = post.excerpt || '';
                    document.getElementById('post-content').value = post.content || '';
                    document.getElementById('post-category').value = post.category || '';
                    document.getElementById('post-image').value = post.imageUrl || '';
                    document.getElementById('post-author').value = post.author || '';
                } else {
                    console.error('Post not found');
                    showToast('Post not found', 'error');
                    hideModal();
                }
            } catch (error) {
                console.error('Error loading post data:', error);
                showToast('Error loading post data', 'error');
                hideModal();
            }
        }

        // Hide modal
        function hideModal() {
            postModal.style.display = 'none';
            postForm.reset();
        }

        // Handle post form submission
        async function handlePostSubmission(e) {
            e.preventDefault();

            if (!isAdmin) {
                showToast('You do not have permission to perform this action', 'error');
                return;
            }

            // Get form data
            const postId = document.getElementById('post-id').value;
            const type = document.getElementById('post-type').value;
            const title = document.getElementById('post-title').value;
            const excerpt = document.getElementById('post-excerpt').value;
            const content = document.getElementById('post-content').value;
            const category = document.getElementById('post-category').value;
            const imageUrl = document.getElementById('post-image').value;
            const author = document.getElementById('post-author').value || 'Admin';

            // Determine collection name
            const collectionName = type === 'featured' ? 'featured_posts' : 'news_posts';

            try {
                if (postId) {
                    // Update existing post
                    await updateDoc(doc(db, collectionName, postId), {
                        title,
                        excerpt,
                        content,
                        category,
                        imageUrl,
                        author,
                        updatedAt: serverTimestamp()
                    });

                    showToast('Post updated successfully');
                } else {
                    // Add new post
                    await addDoc(collection(db, collectionName), {
                        title,
                        excerpt,
                        content,
                        category,
                        imageUrl,
                        author,
                        views: 0,
                        createdAt: serverTimestamp(),
                        updatedAt: serverTimestamp()
                    });

                    showToast('Post created successfully');
                }

                // Hide modal
                hideModal();

                // Reload content
                if (type === 'featured') {
                    loadFeaturedPosts();
                } else {
                    loadLatestNews();
                }
            } catch (error) {
                console.error('Error saving post:', error);
                showToast('Error saving post. Please try again.', 'error');
            }
        }

        // Handle post actions (edit/delete)
        function handlePostActions(e) {
            // Check if clicked element is an edit or delete button
            const editBtn = e.target.closest('.edit-post-btn');
            const deleteBtn = e.target.closest('.delete-post-btn');

            if (editBtn) {
                e.stopPropagation(); // Prevent navigation
                const postId = deleteBtn.dataset.id;
                const type = deleteBtn.dataset.type;
                confirmDeletePost(type, postId);
            }
        }

        // Confirm post deletion
        function confirmDeletePost(type, postId) {
            if (confirm('Are you sure you want to delete this post? This action cannot be undone.')) {
                deletePost(type, postId);
            }
        }

        // Delete post
        async function deletePost(type, postId) {
            if (!isAdmin) {
                showToast('You do not have permission to perform this action', 'error');
                return;
            }

            try {
                const collectionName = type === 'featured' ? 'featured_posts' : 'news_posts';

                // Delete post from Firestore
                await deleteDoc(doc(db, collectionName, postId));

                showToast('Post deleted successfully');

                // Reload content
                if (type === 'featured') {
                    loadFeaturedPosts();
                } else {
                    loadLatestNews();
                }
            } catch (error) {
                console.error('Error deleting post:', error);
                showToast('Error deleting post. Please try again.', 'error');
            }
        }

        // Handle newsletter submission
        async function handleNewsletterSubmission(e) {
            e.preventDefault();

            const emailInput = e.target.querySelector('input[type="email"]');
            const email = emailInput.value.trim();

            try {
                // Add to Firestore
                await addDoc(collection(db, 'newsletter_subscribers'), {
                    email,
                    subscribedAt: serverTimestamp()
                });

                // Show success message
                emailInput.value = '';
                showToast('Thank you for subscribing to our newsletter!');
            } catch (error) {
                console.error('Error subscribing to newsletter:', error);
                showToast('Error subscribing to newsletter. Please try again.', 'error');
            }
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            // Create toast container if it doesn't exist
            let toastContainer = document.querySelector('.toast-container');

            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.className = 'toast-container';
                document.body.appendChild(toastContainer);
            }

            // Create toast
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;

            // Add to container
            toastContainer.appendChild(toast);

            // Auto remove after 3 seconds
            setTimeout(() => {
                toast.classList.add('hide');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }

        // Format date helper
        function formatDate(dateObj) {
            if (!dateObj) return 'Just now';

            // Handle Firestore timestamps
            if (dateObj && dateObj.toDate && typeof dateObj.toDate === 'function') {
                dateObj = dateObj.toDate();
            }

            const options = { month: 'short', day: 'numeric', year: 'numeric' };
            return dateObj.toLocaleDateString('en-US', options);
        }

        // Capitalize first letter
        function capitalizeFirstLetter(string) {
            if (!string) return '';
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
    </script>

    <style>
        /* Additional styles for admin features */
        .admin-controls {
            margin: 20px 0;
            text-align: center;
        }

        .admin-btn {
            background-color: #4a6cf7;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 4px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .admin-btn:hover {
            background-color: #3a57d0;
        }

        .admin-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
            padding: 5px;
            display: flex;
            gap: 5px;
        }

        .admin-actions button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-actions button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .edit-post-btn:hover {
            color: #4a6cf7;
        }

        .delete-post-btn:hover {
            color: #f44336;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
        }

        .form-group textarea {
            resize: vertical;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .cancel-btn {
            background-color: #f1f1f1;
            color: #333;
        }

        .save-btn {
            background-color: #4a6cf7;
            color: white;
        }

        .loading-indicator {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .empty-state {
            text-align: center;
            padding: 30px;
            background: #f9f9f9;
            border-radius: 8px;
            color: #666;
        }

        .error-state {
            text-align: center;
            padding: 30px;
            background: #fff5f5;
            border-radius: 8px;
            color: #e53e3e;
        }

        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .toast {
            padding: 12px 20px;
            margin-top: 10px;
            border-radius: 4px;
            color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: opacity 0.3s;
        }

        .toast.success {
            background-color: #4caf50;
        }

        .toast.error {
            background-color: #f44336;
        }

        .toast.hide {
            opacity: 0;
        }
    </style>
</body>

</html>agation(); // Prevent navigation
const postId = editBtn.dataset.id;
const type = editBtn.dataset.type;
showAddPostModal(type, postId);
} else if (deleteBtn) {
e.stopProp